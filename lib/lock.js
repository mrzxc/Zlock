"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();!function(){var t=null;window.Zlock=function(){function i(e){if(_classCallCheck(this,i),t)return t;if(t=this,!window.localStorage)throw new Error("您的浏览器不支持localStorage,或者开启了隐身模式");var s={matrixNum:3,hollowColor:"#999999",selectedColor:"#666666",solidColor:"#6699cc",errorColor:"#ff0000",successColor:"#5bc0de",bdColor:"rgba(64,64,64,0.9)"};e=Object.assign(this,s,e),this.config=e,this.inputArr=document.getElementsByName(e.inputName),this.selectedColor=e.selectedColor,this.canvasId=e.canvasId,this.canvas=window.document.getElementById(this.canvasId),this.ctx=this.canvas.getContext("2d"),this.init()}return _createClass(i,[{key:"init",value:function(){this.canvas.width=document.documentElement.clientWidth,this.canvas.height=document.documentElement.clientHeight,this.prop=this.canvas.width/this.ctx.canvas.width,this.hollowColor=this.config.hollowColor,this.solidColor=this.config.solidColor,this.touchFlag=!1,this.HCircleArr=this.HCircleInit(),this.viewCircleArr=this.ViewCircleInit(),this.existPoints=this.viewCircleArr.slice(0),this.selectedStack=[],this.drawCurrentStatus(),this.bindEvent()}},{key:"HCircleInit",value:function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);for(var t=this.r=this.ctx.canvas.width/(2+4*this.matrixNum),i=[],e=0;e<3;e++)for(var s=0;s<3;s++)i.push({x:(4*s+3)*t,y:(4*e+3)*t+.08*this.ctx.canvas.height});return i}},{key:"ViewCircleInit",value:function(){var t=this.HCircleArr,i=this.prop;return t.map(function(t){return{x:t.x*i,y:t.y*i}})}},{key:"drawCurrentStatus",value:function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.fillStyle=this.bdColor,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.strokeStyle=this.hollowColor;var t=this.HCircleArr;this.ctx.lineWidth=4,this.ctx.beginPath();for(var i=0,e=this.r;i<t.length;i++)this.ctx.moveTo(t[i].x+e,t[i].y),this.ctx.arc(t[i].x,t[i].y,e,0,2*Math.PI,!0);this.ctx.globalCompositeOperation="destination-out",this.ctx.stroke(),this.ctx.globalCompositeOperation="source-over",this.ctx.closePath(),t=this.selectedStack,this.ctx.fillStyle=this.solidColor,this.ctx.beginPath();for(var s=0,o=this.r;s<t.length;s++)this.ctx.moveTo(t[s].x+o/2,t[s].y),this.ctx.arc(t[s].x,t[s].y,o/2,0,2*Math.PI,!0);this.ctx.fill(),this.ctx.closePath(),this.ctx.strokeStyle=this.selectedColor,this.ctx.beginPath();for(var c=0,r=this.r;c<t.length;c++)this.ctx.moveTo(t[c].x+r,t[c].y),this.ctx.arc(t[c].x,t[c].y,r,0,2*Math.PI,!0);this.ctx.stroke(),this.ctx.closePath(),this.ctx.strokeStyle=this.solidColor,this.ctx.beginPath();var h=0;for(this.r;h<t.length;h++)this.ctx.lineTo(t[h].x,t[h].y);this.ctx.stroke(),this.ctx.closePath()}},{key:"bindEvent",value:function(){var t=this,i=this,e=this.r;this.canvas.addEventListener("touchstart",function(s){s.preventDefault();for(var o,c,r=i.getPosition(s),h=0;h<i.existPoints.length;h++)if(o=Math.abs(r.x-i.existPoints[h].x),c=Math.abs(r.y-i.existPoints[h].y),o*o+c*c<e*e){i.touchFlag=!0,i.selectedStack.push(i.existPoints[h]),i.existPoints.splice(h,1),t.drawCurrentStatus();break}},!1),this.canvas.addEventListener("touchmove",function(t){i.touchFlag&&i.update(i.getPosition(t))},!1),this.canvas.addEventListener("touchend",function(e){i.touchFlag&&(i.touchFlag=!1,i.pwdObj.pwdArr=i.transcoding(),t.drawCurrentStatus(),window.setTimeout(function(){i.init()},500))},!1)}},{key:"update",value:function(t){var i=this.r;this.drawCurrentStatus();var e=this.selectedStack[this.selectedStack.length-1];this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.closePath(),this.ctx.stroke();for(var s,o,c=0;c<this.existPoints.length;c++)if(s=Math.abs(t.x-this.existPoints[c].x),o=Math.abs(t.y-this.existPoints[c].y),s*s+o*o<i*i){this.touchFlag=!0,this.selectedStack.push(this.existPoints[c]),this.existPoints.splice(c,1);break}}},{key:"getPosition",value:function(t){var i=t.currentTarget.getBoundingClientRect();return{x:t.touches[0].clientX-i.left,y:t.touches[0].clientY-i.top}}},{key:"viewToContext",value:function(t){return{x:t.x/this.prop,y:t.y/this.prop}}},{key:"error",value:function(){this.solidColor=this.errorColor}},{key:"success",value:function(){this.solidColor=this.successColor}},{key:"transcoding",value:function(){for(var t=this.selectedStack,i=this.HCircleArr,e=[],s=0;s<t.length;s++)for(var o=0;o<i.length;o++)t[s].x===i[o].x&&t[s].y===i[o].y&&e.push(o+1);return e}}]),i}()}();